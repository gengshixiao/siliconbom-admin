<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>智能体运营看板</title>
  <link rel="icon" type="image/png" href="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/f4f1acead1b2b1cfc74946089e643749.png" />
  <link rel="stylesheet" href="css/common.css" />
  <link rel="stylesheet" href="css/dashboard.css" />
</head>
<body>
  <div class="page-header">
    <h1>智能体运营看板</h1>
  </div>

  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-label">会话次数（今日）</div>
      <div class="kpi-value">3,842</div>
      <div class="kpi-footer">
        <span class="delta up">↑ 12.0%</span>
        <span>日环比</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">对话次数（消息/今日）</div>
      <div class="kpi-value">24,560</div>
      <div class="kpi-footer">
        <span class="delta up">↑ 9.1%</span>
        <span>日环比</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Token（今日）</div>
      <div class="kpi-value">8.42M</div>
      <div class="kpi-footer">
        <span class="delta up">↑ 6.8%</span>
        <span>日环比</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">工具调用（今日）</div>
      <div class="kpi-value">6,980</div>
      <div class="kpi-footer">
        <span class="delta down">↓ 2.3%</span>
        <span>日环比</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">首字响应（TTFT）</div>
      <div class="kpi-value">1.26s</div>
      <div class="kpi-footer">
        <span class="delta up">↓ 8.4%</span>
        <span>更快</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">任务终止率（今日）</div>
      <div class="kpi-value">3.8%</div>
      <div class="kpi-footer">
        <span class="delta down">↑ 0.6%</span>
        <span>偏高</span>
      </div>
    </div>
  </div>

  <div class="grid-layout">
    <div class="chart-container span-6">
      <div class="chart-header">
        <div class="chart-title">对话概览</div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-purple);"></span>
            <span>会话次数</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-teal);"></span>
            <span>对话次数</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: #888;"></span>
            <span>消息/会话</span>
          </div>
        </div>
      </div>
      <div class="chart-area">
        <div id="chart-dialogue-overview" style="width: 100%; height: 240px;"></div>
      </div>
    </div>

    <div class="chart-container span-6">
      <div class="chart-header">
        <div class="chart-title">Token 消耗</div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-purple);"></span>
            <span>输入</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-teal);"></span>
            <span>输出</span>
          </div>
        </div>
      </div>
      <div class="chart-area">
        <div id="chart-token-consumption" style="width: 100%; height: 240px;"></div>
      </div>
      <div class="stat-grid">
        <div class="stat-item">
          <div class="stat-label">今日 Token</div>
          <div class="stat-value">8.42M</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">单会话 Token</div>
          <div class="stat-value">P50 1,820</div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid-layout">
    <div class="chart-container span-6">
      <div class="chart-header">
        <div class="chart-title">工具调用</div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-purple);"></span>
            <span>调用次数</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-teal);"></span>
            <span>耗时 P50</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: #888;"></span>
            <span>耗时 P95</span>
          </div>
        </div>
      </div>
      <div class="chart-area">
        <div id="chart-tool-calls" style="width: 100%; height: 240px;"></div>
      </div>
    </div>

    <div class="chart-container span-6">
      <div class="chart-header">
        <div class="chart-title">工具分类占比</div>
      </div>
      <div style="display: flex; gap: 16px; align-items: center;">
        <svg viewBox="0 0 180 180" width="180" height="180">
          <circle cx="90" cy="90" r="60" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="14"/>
          <circle cx="90" cy="90" r="60" fill="none" stroke="var(--color-purple)" stroke-width="14" stroke-dasharray="113 377" stroke-linecap="round" transform="rotate(-90 90 90)"/>
          <circle cx="90" cy="90" r="60" fill="none" stroke="var(--color-teal)" stroke-width="14" stroke-dasharray="83 377" stroke-dashoffset="-113" stroke-linecap="round" transform="rotate(-90 90 90)"/>
          <circle cx="90" cy="90" r="60" fill="none" stroke="var(--color-pink)" stroke-width="14" stroke-dasharray="106 377" stroke-dashoffset="-196" stroke-linecap="round" transform="rotate(-90 90 90)"/>
          <circle cx="90" cy="90" r="60" fill="none" stroke="#999" stroke-width="14" stroke-dasharray="75 377" stroke-dashoffset="-302" stroke-linecap="round" transform="rotate(-90 90 90)"/>
          <text x="90" y="85" text-anchor="middle" fill="var(--text)" font-size="11" font-weight="600">今日调用</text>
          <text x="90" y="105" text-anchor="middle" fill="var(--text)" font-size="18" font-weight="600">6,980</text>
        </svg>
        <div style="flex: 1;">
          <div class="list-item">
            <span><strong>知识库检索</strong></span>
            <span>2,094（30%）</span>
          </div>
          <div class="list-item">
            <span><strong>数据查询</strong></span>
            <span>1,954（28%）</span>
          </div>
          <div class="list-item">
            <span><strong>BOM 读取</strong></span>
            <span>1,536（22%）</span>
          </div>
          <div class="list-item">
            <span><strong>规格书读取</strong></span>
            <span>1,396（20%）</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid-layout">
    <div class="chart-container span-6">
      <div class="chart-header">
        <div class="chart-title">首字响应（TTFT）</div>
      </div>
      <div class="chart-area">
        <div id="chart-ttft" style="width: 100%; height: 240px;"></div>
      </div>
      <div class="stat-grid">
        <div class="stat-item">
          <div class="stat-label">TTFT（今日）</div>
          <div class="stat-value">均值 1.26s</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">P50 / P95</div>
          <div class="stat-value">0.92s / 3.40s</div>
        </div>
      </div>
    </div>

    <div class="chart-container span-6">
      <div class="chart-header">
        <div class="chart-title">任务终止</div>
      </div>
      <div class="chart-area">
        <div id="chart-task-termination" style="width: 100%; height: 240px;"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <script src="js/common.js"></script>
  <script src="js/echarts-helper.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof echarts === 'undefined') {
        console.error('ECharts not loaded');
        return;
      }

      // 对话概览图表数据（30天数据）
    const dialogueData = [];
    const today = new Date();
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      
      // 模拟数据
      const sessionCount = Math.round(3200 + Math.random() * 600);
      const dialogueCount = Math.round(2000 + Math.random() * 500);
      const msgPerSession = (5.5 + Math.random() * 1).toFixed(1);
      dialogueData.push({
        date: dateStr,
        values: [sessionCount, dialogueCount, parseFloat(msgPerSession)]
      });
    }

    createZoomableChart('chart-dialogue-overview', {
      data: dialogueData,
      chartType: 'stackedArea',
      yAxis: {
        min: 0,
        max: 4000
      },
      series: [
        { name: '会话次数', color: '#8b7a9b' },
        { name: '对话次数', color: '#7a9b9b' },
        { name: '消息/会话', color: '#888' }
      ]
    });

    // Token消耗图表数据（30天数据）
    const tokenData = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      
      // 模拟数据
      const output = Math.round(3800000 + Math.random() * 600000);
      const input = Math.round(3400000 + Math.random() * 500000);
      tokenData.push({
        date: dateStr,
        values: [output, input]
      });
    }

    createZoomableChart('chart-token-consumption', {
      data: tokenData,
      chartType: 'stackedBar',
      yAxis: {
        min: 0,
        max: 5000000,
        format: (v) => (v / 1000000).toFixed(2) + 'M'
      },
      series: [
        { name: '输出', color: '#7a9b9b' },
        { name: '输入', color: '#8b7a9b' }
      ]
    });

    // 工具调用图表数据（30天数据）
    const toolCallData = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      
      // 模拟数据
      const callCount = Math.round(220 + Math.random() * 60);
      const p50 = Math.round(90 + Math.random() * 30);
      const p95 = Math.round(70 + Math.random() * 30);
      toolCallData.push({
        date: dateStr,
        values: [callCount, p50, p95]
      });
    }

    createZoomableChart('chart-tool-calls', {
      data: toolCallData,
      chartType: 'line',
      yAxis: {
        min: 0,
        max: 300
      },
      series: [
        { name: '调用次数', color: '#8b7a9b' },
        { name: '耗时 P50', color: '#7a9b9b' },
        { name: '耗时 P95', color: '#888' }
      ]
    });

    // TTFT图表数据（30天数据）
    const ttftData = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      
      // 模拟数据
      const ttft = (1.2 + Math.random() * 0.2).toFixed(2);
      ttftData.push({
        date: dateStr,
        values: [parseFloat(ttft)]
      });
    }

    createZoomableChart('chart-ttft', {
      data: ttftData,
      chartType: 'bar',
      yAxis: {
        min: 0,
        max: 2.5,
        format: (v) => v.toFixed(2) + 's'
      },
      series: [
        { name: 'TTFT', color: '#7a9b9b' }
      ]
    });

    // 任务终止图表数据（30天数据）
    const terminationData = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      
      // 模拟数据
      const rate = (3.0 + Math.random() * 1.0).toFixed(1);
      terminationData.push({
        date: dateStr,
        values: [parseFloat(rate)]
      });
    }

    createZoomableChart('chart-task-termination', {
      data: terminationData,
      chartType: 'area',
      yAxis: {
        min: 0,
        max: 5,
        format: (v) => v.toFixed(1) + '%'
      },
      series: [
        { name: '终止率', color: '#9b7a8b' }
      ]
    });
    });
  </script>
</body>
</html>
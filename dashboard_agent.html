<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>智能体运营看板</title>
  <link rel="icon" type="image/png" href="https://chat-web-1253214834.cos.ap-beijing.myqcloud.com/image/f4f1acead1b2b1cfc74946089e643749.png" />
  <link rel="stylesheet" href="css/common.css" />
  <link rel="stylesheet" href="css/dashboard.css" />
</head>
<body>
  <div class="page-header">
    <h1>智能体运营看板</h1>
    <div class="meta">
      <span class="chip">时间范围
        <select>
          <option>近 24 小时</option>
          <option>近 7 天</option>
          <option selected>近 30 天</option>
        </select>
      </span>
      <span class="chip">分组
        <select>
          <option selected>按天</option>
          <option>按小时</option>
        </select>
      </span>
      <span class="chip">更新时间：2025-01-15 18:30</span>
    </div>
  </div>

  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-label">会话次数（今日）</div>
      <div class="kpi-value">3,842</div>
      <div class="kpi-footer">
        <span class="delta up">↑ 12.0%</span>
        <span>日环比</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">对话次数（消息/今日）</div>
      <div class="kpi-value">24,560</div>
      <div class="kpi-footer">
        <span class="delta up">↑ 9.1%</span>
        <span>日环比</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Token（今日）</div>
      <div class="kpi-value">8.42M</div>
      <div class="kpi-footer">
        <span class="delta up">↑ 6.8%</span>
        <span>日环比</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">工具调用（今日）</div>
      <div class="kpi-value">6,980</div>
      <div class="kpi-footer">
        <span class="delta down">↓ 2.3%</span>
        <span>日环比</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">首字响应（TTFT）</div>
      <div class="kpi-value">1.26s</div>
      <div class="kpi-footer">
        <span class="delta up">↓ 8.4%</span>
        <span>更快</span>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">任务终止率（今日）</div>
      <div class="kpi-value">3.8%</div>
      <div class="kpi-footer">
        <span class="delta down">↑ 0.6%</span>
        <span>偏高</span>
      </div>
    </div>
  </div>

  <div class="grid-layout">
    <div class="chart-container span-8">
      <div class="chart-header">
        <div class="chart-title">对话概览</div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-purple);"></span>
            <span>会话次数</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-teal);"></span>
            <span>对话次数</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: #888;"></span>
            <span>消息/会话</span>
          </div>
        </div>
      </div>
      <div class="chart-area">
        <svg viewBox="0 0 800 280" width="100%" height="280" style="display: block;" id="chart-dialogue-overview">
          <defs>
            <linearGradient id="grad2" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="rgba(139, 122, 155, 0.3)"/>
              <stop offset="100%" stop-color="rgba(139, 122, 155, 0)"/>
            </linearGradient>
          </defs>
          <g stroke="rgba(255,255,255,0.05)" stroke-width="1">
            <line x1="40" y1="40" x2="760" y2="40"/>
            <line x1="40" y1="100" x2="760" y2="100"/>
            <line x1="40" y1="160" x2="760" y2="160"/>
            <line x1="40" y1="220" x2="760" y2="220"/>
            <line x1="40" y1="280" x2="760" y2="280"/>
          </g>
          <g stroke="rgba(255,255,255,0.1)" stroke-width="1.5">
            <line x1="40" y1="20" x2="40" y2="280"/>
            <line x1="40" y1="280" x2="760" y2="280"/>
          </g>
          <path d="M40,280 L80,240 L120,244 L160,232 L200,240 L240,224 L280,214 L320,218 L360,202 L400,190 L440,194 L480,176 L520,170 L560,158 L600,166 L640,146 L680,138 L720,126 L760,132 L760,280 Z" fill="url(#grad2)"/>
          <path d="M80,240 L120,244 L160,232 L200,240 L240,224 L280,214 L320,218 L360,202 L400,190 L440,194 L480,176 L520,170 L560,158 L600,166 L640,146 L680,138 L720,126 L760,132" fill="none" stroke="var(--color-purple)" stroke-width="2.5" stroke-linecap="round"/>
          <path d="M80,178 L120,182 L160,174 L200,186 L240,180 L280,174 L320,168 L360,174 L400,166 L440,160 L480,164 L520,158 L560,152 L600,148 L640,150 L680,142 L720,138 L760,134" fill="none" stroke="var(--color-teal)" stroke-width="2.5" stroke-linecap="round"/>
          <path d="M80,130 L120,132 L160,128 L200,134 L240,133 L280,131 L320,129 L360,130 L400,128 L440,126 L480,127 L520,125 L560,123 L600,121 L640,122 L680,120 L720,119 L760,118" fill="none" stroke="var(--color-pink)" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
      </div>
    </div>

    <div class="chart-container span-4">
      <div class="chart-header">
        <div class="chart-title">Token 消耗</div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-purple);"></span>
            <span>输入</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-teal);"></span>
            <span>输出</span>
          </div>
        </div>
      </div>
      <div class="chart-area">
        <svg viewBox="0 0 400 280" width="100%" height="280" style="display: block;" id="chart-token-consumption">
          <g stroke="rgba(255,255,255,0.05)" stroke-width="1">
            <line x1="40" y1="40" x2="360" y2="40"/>
            <line x1="40" y1="100" x2="360" y2="100"/>
            <line x1="40" y1="160" x2="360" y2="160"/>
            <line x1="40" y1="220" x2="360" y2="220"/>
          </g>
          <g stroke="rgba(255,255,255,0.1)" stroke-width="1.5">
            <line x1="40" y1="20" x2="40" y2="240"/>
            <line x1="40" y1="240" x2="360" y2="240"/>
          </g>
          <path d="M40,240 L60,200 L80,204 L100,192 L120,194 L140,180 L160,176 L180,170 L200,172 L220,160 L240,162 L260,150 L280,142 L300,134 L320,126 L340,114 L360,110 L360,240 Z" fill="url(#grad2)"/>
          <path d="M60,200 L80,204 L100,192 L120,194 L140,180 L160,176 L180,170 L200,172 L220,160 L240,162 L260,150 L280,142 L300,134 L320,126 L340,114 L360,110" fill="none" stroke="var(--color-teal)" stroke-width="2.5" stroke-linecap="round"/>
          <path d="M60,180 L80,184 L100,172 L120,174 L140,160 L160,156 L180,150 L200,152 L220,140 L240,142 L260,130 L280,122 L300,114 L320,106 L340,94 L360,90" fill="none" stroke="var(--color-purple)" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="stat-grid">
        <div class="stat-item">
          <div class="stat-label">今日 Token</div>
          <div class="stat-value">8.42M</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">单会话 Token</div>
          <div class="stat-value">P50 1,820</div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid-layout">
    <div class="chart-container span-8">
      <div class="chart-header">
        <div class="chart-title">工具调用</div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-purple);"></span>
            <span>调用次数</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: var(--color-teal);"></span>
            <span>耗时 P50</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot" style="background: #888;"></span>
            <span>耗时 P95</span>
          </div>
        </div>
      </div>
      <div class="chart-area">
        <svg viewBox="0 0 800 280" width="100%" height="280" style="display: block;" id="chart-tool-calls">
          <g stroke="rgba(255,255,255,0.05)" stroke-width="1">
            <line x1="40" y1="40" x2="760" y2="40"/>
            <line x1="40" y1="100" x2="760" y2="100"/>
            <line x1="40" y1="160" x2="760" y2="160"/>
            <line x1="40" y1="220" x2="760" y2="220"/>
            <line x1="40" y1="280" x2="760" y2="280"/>
          </g>
          <g stroke="rgba(255,255,255,0.1)" stroke-width="1.5">
            <line x1="40" y1="20" x2="40" y2="280"/>
            <line x1="40" y1="280" x2="760" y2="280"/>
          </g>
          <path d="M80,214 L120,204 L160,212 L200,198 L240,192 L280,182 L320,188 L360,174 L400,162 L440,170 L480,154 L520,148 L560,140 L600,146 L640,132 L680,126 L720,114 L760,120" fill="none" stroke="var(--color-purple)" stroke-width="2.5" stroke-linecap="round"/>
          <path d="M80,150 L120,152 L160,148 L200,156 L240,154 L280,150 L320,146 L360,150 L400,144 L440,140 L480,142 L520,138 L560,134 L600,132 L640,132 L680,128 L720,126 L760,124" fill="none" stroke="var(--color-teal)" stroke-width="2.5" stroke-linecap="round"/>
          <path d="M80,120 L120,124 L160,118 L200,130 L240,126 L280,122 L320,118 L360,126 L400,116 L440,112 L480,114 L520,110 L560,106 L600,104 L640,104 L680,102 L720,100 L760,98" fill="none" stroke="var(--color-pink)" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
      </div>
    </div>

    <div class="chart-container span-4">
      <div class="chart-header">
        <div class="chart-title">工具分类占比</div>
      </div>
      <div style="display: flex; gap: 16px; align-items: center;">
        <svg viewBox="0 0 180 180" width="180" height="180">
          <circle cx="90" cy="90" r="60" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="14"/>
          <circle cx="90" cy="90" r="60" fill="none" stroke="var(--color-purple)" stroke-width="14" stroke-dasharray="113 377" stroke-linecap="round" transform="rotate(-90 90 90)"/>
          <circle cx="90" cy="90" r="60" fill="none" stroke="var(--color-teal)" stroke-width="14" stroke-dasharray="83 377" stroke-dashoffset="-113" stroke-linecap="round" transform="rotate(-90 90 90)"/>
          <circle cx="90" cy="90" r="60" fill="none" stroke="var(--color-pink)" stroke-width="14" stroke-dasharray="106 377" stroke-dashoffset="-196" stroke-linecap="round" transform="rotate(-90 90 90)"/>
          <circle cx="90" cy="90" r="60" fill="none" stroke="#999" stroke-width="14" stroke-dasharray="75 377" stroke-dashoffset="-302" stroke-linecap="round" transform="rotate(-90 90 90)"/>
          <text x="90" y="85" text-anchor="middle" fill="var(--text)" font-size="11" font-weight="600">今日调用</text>
          <text x="90" y="105" text-anchor="middle" fill="var(--text)" font-size="18" font-weight="600">6,980</text>
        </svg>
        <div style="flex: 1;">
          <div class="list-item">
            <span><strong>知识库检索</strong></span>
            <span>2,094（30%）</span>
          </div>
          <div class="list-item">
            <span><strong>数据查询</strong></span>
            <span>1,954（28%）</span>
          </div>
          <div class="list-item">
            <span><strong>BOM 读取</strong></span>
            <span>1,536（22%）</span>
          </div>
          <div class="list-item">
            <span><strong>规格书读取</strong></span>
            <span>1,396（20%）</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid-layout">
    <div class="chart-container span-6">
      <div class="chart-header">
        <div class="chart-title">首字响应（TTFT）</div>
      </div>
      <div class="chart-area">
        <svg viewBox="0 0 600 280" width="100%" height="280" style="display: block;" id="chart-ttft">
          <g stroke="rgba(255,255,255,0.05)" stroke-width="1">
            <line x1="40" y1="40" x2="560" y2="40"/>
            <line x1="40" y1="100" x2="560" y2="100"/>
            <line x1="40" y1="160" x2="560" y2="160"/>
            <line x1="40" y1="220" x2="560" y2="220"/>
            <line x1="40" y1="280" x2="560" y2="280"/>
          </g>
          <g stroke="rgba(255,255,255,0.1)" stroke-width="1.5">
            <line x1="40" y1="20" x2="40" y2="280"/>
            <line x1="40" y1="280" x2="560" y2="280"/>
          </g>
          <rect x="100" y="212" width="60" height="68" rx="6" fill="var(--color-blue)" opacity="0.4"/>
          <rect x="200" y="176" width="60" height="104" rx="6" fill="var(--color-blue)" opacity="0.4"/>
          <rect x="300" y="136" width="60" height="144" rx="6" fill="var(--color-blue)" opacity="0.4"/>
          <rect x="400" y="154" width="60" height="126" rx="6" fill="var(--color-blue)" opacity="0.4"/>
          <rect x="500" y="194" width="60" height="86" rx="6" fill="var(--color-blue)" opacity="0.4"/>
          <path d="M130,128 L230,140 L330,150 L430,156 L530,152" fill="none" stroke="var(--color-teal)" stroke-width="2.5" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="stat-grid">
        <div class="stat-item">
          <div class="stat-label">TTFT（今日）</div>
          <div class="stat-value">均值 1.26s</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">P50 / P95</div>
          <div class="stat-value">0.92s / 3.40s</div>
        </div>
      </div>
    </div>

    <div class="chart-container span-6">
      <div class="chart-header">
        <div class="chart-title">任务终止</div>
      </div>
      <div style="display: flex; gap: 16px; align-items: center;">
        <svg viewBox="0 0 300 260" width="300" height="260" id="chart-task-termination">
          <g stroke="rgba(255,255,255,0.05)" stroke-width="1">
            <line x1="40" y1="40" x2="280" y2="40"/>
            <line x1="40" y1="100" x2="280" y2="100"/>
            <line x1="40" y1="160" x2="280" y2="160"/>
            <line x1="40" y1="220" x2="280" y2="220"/>
          </g>
          <g stroke="rgba(255,255,255,0.1)" stroke-width="1.5">
            <line x1="40" y1="20" x2="40" y2="240"/>
            <line x1="40" y1="240" x2="280" y2="240"/>
          </g>
          <path d="M40,240 L60,200 L80,210 L100,200 L120,206 L140,194 L160,188 L180,192 L200,180 L220,174 L240,168 L260,176 L280,170 L280,240 Z" fill="url(#grad2)"/>
          <path d="M60,200 L80,210 L100,200 L120,206 L140,194 L160,188 L180,192 L200,180 L220,174 L240,168 L260,176 L280,170" fill="none" stroke="var(--color-pink)" stroke-width="2.5" stroke-linecap="round"/>
          <text x="40" y="255" fill="var(--text-muted)" font-size="11">今日：3.8%</text>
        </svg>
        <div style="flex: 1;">
          <svg viewBox="0 0 200 200" width="200" height="200">
            <g transform="translate(100,100)">
              <circle r="70" fill="rgba(255,255,255,0.05)"/>
              <path d="M0,0 L70,0 A70,70 0 0,1 21.2,66.5 Z" fill="var(--color-blue)"/>
              <path d="M0,0 L21.2,66.5 A70,70 0 0,1 -70,0 Z" fill="var(--accent-light)"/>
              <path d="M0,0 L-70,0 A70,70 0 0,1 70,0 Z" fill="var(--color-pink)"/>
              <circle r="70" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="2"/>
            </g>
            <text x="100" y="195" text-anchor="middle" fill="var(--text)" font-size="12" font-weight="600">今日终止：146</text>
          </svg>
          <div style="margin-top: 12px;">
            <div class="list-item">
              <span><strong>网络问题</strong></span>
              <span>30%</span>
            </div>
            <div class="list-item">
              <span><strong>智能体报错</strong></span>
              <span>45%</span>
            </div>
            <div class="list-item">
              <span><strong>手动停止</strong></span>
              <span>25%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="js/common.js"></script>
  <script src="js/chart-enhance.js"></script>
  <script>
    // 生成日期标签
    const dateLabels = generateDateLabels(30, 'M-D');
    
    // 对话概览图表数据（30天数据）
    const dialogueData = [];
    const today = new Date();
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      const dayLabel = `${date.getMonth() + 1}-${date.getDate()}`;
      
      // 模拟数据
      const sessionCount = Math.round(3200 + Math.random() * 600);
      const dialogueCount = Math.round(2000 + Math.random() * 500);
      const msgPerSession = (5.5 + Math.random() * 1).toFixed(1);
      dialogueData.push({
        x: 29 - i,
        values: [sessionCount, dialogueCount, parseFloat(msgPerSession)],
        label: dayLabel,
        date: dateStr
      });
    }

    enhanceChart('#chart-dialogue-overview', {
      data: dialogueData,
      axes: {
        x: {
          labels: dateLabels
        },
        y: {
          labels: ['0', '1000', '2000', '3000', '4000'],
          min: 0,
          max: 4000
        }
      },
      series: [
        { name: '会话次数', color: 'var(--color-purple)' },
        { name: '对话次数', color: 'var(--color-teal)' },
        { name: '消息/会话', color: '#888' }
      ]
    });

    // Token消耗图表数据（30天数据）
    const tokenData = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      const dayLabel = `${date.getMonth() + 1}-${date.getDate()}`;
      
      // 模拟数据
      const output = Math.round(3800000 + Math.random() * 600000);
      const input = Math.round(3400000 + Math.random() * 500000);
      tokenData.push({
        x: 29 - i,
        values: [output, input],
        label: dayLabel,
        date: dateStr
      });
    }

    enhanceChart('#chart-token-consumption', {
      data: tokenData,
      axes: {
        x: {
          labels: dateLabels
        },
        y: {
          labels: ['0', '1M', '2M', '3M', '4M', '5M'],
          min: 0,
          max: 5000000,
          format: (v) => (v / 1000000).toFixed(2) + 'M'
        }
      },
      series: [
        { name: '输出', color: 'var(--color-teal)' },
        { name: '输入', color: 'var(--color-purple)' }
      ]
    });

    // 工具调用图表数据（30天数据）
    const toolCallData = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      const dayLabel = `${date.getMonth() + 1}-${date.getDate()}`;
      
      // 模拟数据
      const callCount = Math.round(220 + Math.random() * 60);
      const p50 = Math.round(90 + Math.random() * 30);
      const p95 = Math.round(70 + Math.random() * 30);
      toolCallData.push({
        x: 29 - i,
        values: [callCount, p50, p95],
        label: dayLabel,
        date: dateStr
      });
    }

    enhanceChart('#chart-tool-calls', {
      data: toolCallData,
      axes: {
        x: {
          labels: dateLabels
        },
        y: {
          labels: ['0', '50', '100', '150', '200', '250', '300'],
          min: 0,
          max: 300
        }
      },
      series: [
        { name: '调用次数', color: 'var(--color-purple)' },
        { name: '耗时 P50', color: 'var(--color-teal)' },
        { name: '耗时 P95', color: '#888' }
      ]
    });

    // TTFT图表数据（30天数据）
    const ttftData = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      const dayLabel = `${date.getMonth() + 1}-${date.getDate()}`;
      
      // 模拟数据
      const ttft = (1.2 + Math.random() * 0.2).toFixed(2);
      ttftData.push({
        x: 29 - i,
        values: [parseFloat(ttft)],
        label: dayLabel,
        date: dateStr
      });
    }

    enhanceChart('#chart-ttft', {
      data: ttftData,
      axes: {
        x: {
          labels: dateLabels
        },
        y: {
          labels: ['0', '0.5', '1.0', '1.5', '2.0', '2.5'],
          min: 0,
          max: 2.5,
          format: (v) => v.toFixed(2) + 's'
        }
      },
      series: [
        { name: 'TTFT', color: 'var(--color-teal)' }
      ]
    });

    // 任务终止图表数据（30天数据）
    const terminationData = [];
    for (let i = 29; i >= 0; i--) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
      const dayLabel = `${date.getMonth() + 1}-${date.getDate()}`;
      
      // 模拟数据
      const rate = (3.0 + Math.random() * 1.0).toFixed(1);
      terminationData.push({
        x: 29 - i,
        values: [parseFloat(rate)],
        label: dayLabel,
        date: dateStr
      });
    }

    enhanceChart('#chart-task-termination', {
      data: terminationData,
      axes: {
        x: {
          labels: dateLabels
        },
        y: {
          labels: ['0%', '1%', '2%', '3%', '4%', '5%'],
          min: 0,
          max: 5,
          format: (v) => v.toFixed(1) + '%'
        }
      },
      series: [
        { name: '终止率', color: 'var(--color-pink)' }
      ]
    });
  </script>
</body>
</html>